<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hostel Attendance â€“ Firebase Cloud</title>
<style>
body{
  font-family:'Segoe UI',Arial,sans-serif;
  background:linear-gradient(135deg,#e3f2fd,#fce4ec);
  padding:10px
}
.box{
  max-width:900px;
  margin:auto;
  background:#fff;
  padding:18px;
  border-radius:12px;
  margin-bottom:14px;
  box-shadow:0 4px 12px rgba(0,0,0,0.1)
}
h2,h3{color:#333;margin-bottom:10px}
label{font-weight:600}
input{
  width:100%;
  max-width:320px;
  padding:9px;
  margin:6px 0;
  font-size:14px;
  border:1px solid #ccc;
  border-radius:6px;
  outline:none
}
input:focus{border-color:#007bff}
button{
  padding:8px 14px;
  margin:6px 4px 6px 0;
  font-size:14px;
  background:#007bff;
  color:#fff;
  border:none;
  border-radius:20px;
  cursor:pointer;
  transition:0.2s
}
button:hover{opacity:0.85}
button.small{
  padding:4px 10px;
  font-size:12px;
  border-radius:14px
}
button.red{background:#dc3545}
button.gray{background:#6c757d}
.student{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 12px;
  background:#f5f7fa;
  margin:6px 0;
  border-radius:10px;
  transition:0.2s
}
.student:hover{background:#eef3f9}
.present{
  background:linear-gradient(90deg,#c8f7c5,#e8ffe8);
  font-weight:600
}
.hidden{display:none}
@media(max-width:600px){
  .student{flex-direction:column;align-items:flex-start;gap:6px}
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="box" id="loginBox">
  <h2>Login</h2>
  <input id="loginUser" placeholder="Username">
  <input id="loginPass" type="password" placeholder="Password">
  <button type="button" onclick="doLogin()">Login</button>
  <p>Use: <b>admin / 1234</b></p>
</div>


<!-- MAIN -->
<div class="box hidden" id="mainBox">
<h2>Hostel Attendance (Cloud)</h2>

<label>Date</label>
<input type="date" id="date">

<button class="gray" id="toggleAddSectionBtn">Show / Hide Add Student</button>
<div id="addSection" class="hidden">
<input id="studentName" placeholder="Student Name">
<input id="roomNo" placeholder="Room Number">
<button id="addBtn">Add Student</button>
<button class="gray" id="toggleStudentsBtn">Show / Hide Students Added</button>
<div id="studentsBlock" class="hidden">
<h3>Students Added</h3>
<div id="studentList"></div>
</div>
</div>

<h3>Today's Attendance</h3>
<input id="searchBox" placeholder="Search student name">
<div id="attendanceList"></div>
<p><b>Total Present:</b> <span id="total">0</span></p>
<button id="showAbsentBtn" class="gray">Show Absent Students</button>
<div id="absentList" class="hidden"></div>
<button id="exportDailyBtn">Export Today (Present Only)</button>
</div>

<!-- FIREBASE SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ðŸ”¥ FIREBASE CONFIG (REPLACE WITH YOUR OWN)
const firebaseConfig = {
  apiKey: "AIzaSyB6r-_Gh7oetNvTGayPLXbkKYqSyiQv204",
  authDomain: "hostelattendance-c912f.firebaseapp.com",
  databaseURL: "https://hostelattendance-c912f-default-rtdb.firebaseio.com",
  projectId: "hostelattendance-c912f",
  storageBucket: "hostelattendance-c912f.firebasestorage.app",
  messagingSenderId: "39772036836",
  appId: "1:39772036836:web:fef0ab68acb8b2fd6056f1"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ===== ELEMENTS =====
const loginBox = document.getElementById('loginBox');
const mainBox = document.getElementById('mainBox');
const loginBtn = document.getElementById('loginBtn');
const username = document.getElementById('username');
const password = document.getElementById('password');
const addBtn = document.getElementById('addBtn');
const toggleStudentsBtn = document.getElementById('toggleStudentsBtn');
const toggleAddSectionBtn = document.getElementById('toggleAddSectionBtn');
const dateInput = document.getElementById('date');
const searchBox = document.getElementById('searchBox');
const studentList = document.getElementById('studentList');
const attendanceList = document.getElementById('attendanceList');
const absentList = document.getElementById('absentList');
const totalSpan = document.getElementById('total');
const showAbsentBtn = document.getElementById('showAbsentBtn');
const addSection = document.getElementById('addSection');
const studentsBlock = document.getElementById('studentsBlock');
const studentName = document.getElementById('studentName');
const roomNo = document.getElementById('roomNo');
const exportDailyBtn = document.getElementById('exportDailyBtn');

let students = {};
let attendance = {};

dateInput.valueAsDate = new Date();

// ===== LOGIN =====
loginBtn.addEventListener('click', function (e) {
  e.preventDefault();
  const u = username.value.trim();
  const p = password.value.trim();
  if (u === 'admin' && p === '1234') {
    loginBox.classList.add('hidden');
    mainBox.classList.remove('hidden');
  } else {
    alert('Invalid username or password');
  }
});

// ===== FIREBASE LISTENERS =====
db.ref('students').on('value',snap=>{
  students = snap.val() || {};
  render();
});
});

db.ref('attendance').on('value',snap=>{
  attendance = snap.val() || {};
  render();
});

// ===== ADD STUDENT =====
addBtn.onclick = ()=>{
  const name = studentName.value.trim();
  const room = roomNo.value.trim();
  if(!name||!room) return alert('Enter name & room');
  db.ref('students').push({name,room});
  studentName.value=''; roomNo.value='';
};

// ===== TOGGLES =====
toggleAddSectionBtn.onclick=()=>addSection.classList.toggle('hidden');
toggleStudentsBtn.onclick=()=>studentsBlock.classList.toggle('hidden');

function toggleAttendance(name){
  const d = dateInput.value;
  if(!attendance[d]) attendance[d]=[];
  const arr = attendance[d];
  const i = arr.indexOf(name);
  if(i===-1) arr.push(name); else arr.splice(i,1);
  db.ref('attendance/'+d).set(arr);
}

function render(){
  studentList.innerHTML=''; attendanceList.innerHTML=''; absentList.innerHTML='';
  let c=0; const d=dateInput.value; const q=searchBox.value.toLowerCase();
  Object.entries(students).forEach(([key,s])=>{
    // Students Added list with delete
    const row=document.createElement('div'); row.className='student';
    row.innerHTML=`<span>${s.name} (Room ${s.room})</span><button class="red small">X</button>`;
    row.querySelector('button').onclick=()=>{
      if(confirm('Delete student?')) db.ref('students/'+key).remove();
    };
    studentList.appendChild(row);

    const p = attendance[d]?.includes(s.name);
    if(q && s.name.toLowerCase().includes(q)){
      const a=document.createElement('div'); a.className='student'+(p?' present':'');
      a.onclick=()=>toggleAttendance(s.name);
      a.innerHTML=`<span>${s.name} - Room ${s.room}</span><span>${p?'âœ”':''}</span>`;
      attendanceList.appendChild(a);
    }
    if(p) c++;
  }); totalSpan.innerText=c;
}

showAbsentBtn.onclick=()=>{
  absentList.classList.toggle('hidden'); absentList.innerHTML='';
  const d=dateInput.value;
  students.forEach(s=>{
    if(!attendance[d]?.includes(s.name)){
      const ab=document.createElement('div'); ab.className='student';
      ab.innerHTML=`<span>${s.name} - Room ${s.room}</span>`;
      absentList.appendChild(ab);
    }
  });
};

exportDailyBtn.onclick=()=>{
  const d=dateInput.value; let csv='Name,Room\n';
  students.forEach(s=>{ if(attendance[d]?.includes(s.name)) csv+=`${s.name},${s.room}\n`; });
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download='Daily_Present_'+d+'.csv'; a.click();
};
function doLogin() {
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value.trim();

  if (u === 'admin' && p === '1234') {
    document.getElementById('loginBox').style.display = 'none';
    document.getElementById('mainBox').style.display = 'block';
  } else {
    alert('Invalid username or password');
  }
}

searchBox.oninput=render; dateInput.onchange=render;
</script>
</body>
</html>
